<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High-Fidelity PDF to PPTX Converter</title>
    
    <!-- Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- PptxGenJS for creating the PowerPoint file -->
    <script src="https://cdn.jsdelivr.net/gh/gitbrent/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
    
    <!-- PDF.js for parsing and rendering the PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        // Set the worker source for PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
</head>
<body class="flex flex-col items-center justify-center min-h-screen bg-slate-100 text-slate-800 font-sans p-4">
    
    <div class="bg-white p-8 md:p-10 rounded-2xl shadow-xl max-w-lg w-full text-center border border-slate-200">
        
        <div class="mb-6 flex justify-center">
            <div class="bg-blue-100 p-4 rounded-full">
                <svg class="w-12 h-12 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                </svg>
            </div>
        </div>
        
        <h1 class="text-2xl font-bold mb-2 text-slate-900">PDF to PPTX Converter</h1>
        <p class="mb-6 text-slate-500 text-sm leading-relaxed">
            Upload your PDF to convert it into a PowerPoint presentation. This tool creates an <strong>image-based PPTX</strong> to ensure 100% of your original styles, tables, and graphs remain perfectly unchanged.
        </p>
        
        <!-- File Upload Area -->
        <div id="uploadArea" class="border-2 border-dashed border-slate-300 rounded-xl p-8 hover:border-blue-500 hover:bg-blue-50 transition duration-200 cursor-pointer relative">
            <input type="file" id="pdfInput" accept="application/pdf" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" onchange="handleFileSelect(event)">
            <div class="pointer-events-none">
                <svg class="w-10 h-10 text-slate-400 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                <p class="text-slate-700 font-medium">Click to upload or drag & drop</p>
                <p class="text-slate-400 text-xs mt-1">.PDF files only</p>
            </div>
        </div>

        <!-- Processing State (Hidden initially) -->
        <div id="processingArea" class="hidden mt-6">
            <div class="w-full bg-slate-200 rounded-full h-2.5 mb-2">
                <div id="progressBar" class="bg-blue-600 h-2.5 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
            <p id="statusText" class="text-sm font-semibold text-blue-700 animate-pulse">Reading PDF...</p>
        </div>

        <!-- Success State (Hidden initially) -->
        <div id="successArea" class="hidden mt-6">
            <div class="bg-green-100 text-green-800 p-4 rounded-lg flex flex-col items-center">
                <svg class="w-8 h-8 mb-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                <p class="font-bold">Conversion Complete!</p>
                <p class="text-sm text-green-700 mt-1">Your PPTX file has been downloaded.</p>
                <button onclick="resetApp()" class="mt-4 text-sm bg-white border border-green-300 px-4 py-2 rounded shadow-sm hover:bg-green-50 transition">Convert Another File</button>
            </div>
        </div>
    </div>

    <script>
        const uploadArea = document.getElementById('uploadArea');
        const processingArea = document.getElementById('processingArea');
        const successArea = document.getElementById('successArea');
        const progressBar = document.getElementById('progressBar');
        const statusText = document.getElementById('statusText');

        // Drag and drop styling
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('border-blue-500', 'bg-blue-50');
        });
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('border-blue-500', 'bg-blue-50');
        });
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('border-blue-500', 'bg-blue-50');
            const file = e.dataTransfer.files[0];
            if (file && file.type === "application/pdf") {
                processPDF(file);
            } else {
                alert("Please upload a valid PDF file.");
            }
        });

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                processPDF(file);
            }
        }

        async function processPDF(file) {
            // UI Switch to processing
            uploadArea.classList.add('hidden');
            processingArea.classList.remove('hidden');
            progressBar.style.width = '5%';
            
            try {
                // 1. Read the PDF File
                statusText.innerText = "Loading PDF Document...";
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                const totalPages = pdf.numPages;
                
                // 2. Initialize PowerPoint File
                statusText.innerText = `Preparing to generate ${totalPages} slides...`;
                let pres = new PptxGenJS();

                // 3. Process Each Page
                for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
                    statusText.innerText = `Converting page ${pageNum} of ${totalPages} (Retaining graphics)...`;
                    progressBar.style.width = `${((pageNum / totalPages) * 90) + 5}%`;
                    
                    const page = await pdf.getPage(pageNum);
                    
                    // We render the PDF at a 2.0 scale to keep the text and graphics crisp
                    const scale = 2.0; 
                    const viewport = page.getViewport({ scale: scale });

                    // Dynamically set PowerPoint Layout size based on the first PDF page
                    if (pageNum === 1) {
                        // Viewport is in points (72 points = 1 inch)
                        const wInches = viewport.width / (72 * scale);
                        const hInches = viewport.height / (72 * scale);
                        pres.defineLayout({ name: 'PDF_Layout', width: wInches, height: hInches });
                        pres.layout = 'PDF_Layout';
                    }

                    // Render PDF page to an off-screen canvas
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;

                    await page.render({ canvasContext: context, viewport: viewport }).promise;

                    // Convert the rendered canvas to a base64 Image
                    const imgData = canvas.toDataURL('image/png');

                    // Add a slide and cover it entirely with the high-res image of the PDF page
                    let slide = pres.addSlide();
                    slide.addImage({ data: imgData, x: 0, y: 0, w: '100%', h: '100%' });
                }

                // 4. Save the file
                statusText.innerText = "Packaging your PowerPoint file...";
                progressBar.style.width = '100%';
                
                const outputName = file.name.replace(/\.[^/.]+$/, "") + "_Converted.pptx";
                await pres.writeFile({ fileName: outputName });

                // UI Switch to Success
                processingArea.classList.add('hidden');
                successArea.classList.remove('hidden');

            } catch (error) {
                console.error("Error generating PPTX: ", error);
                alert("An error occurred while processing the PDF. Please check the console.");
                resetApp();
            }
        }

        function resetApp() {
            document.getElementById('pdfInput').value = '';
            successArea.classList.add('hidden');
            processingArea.classList.add('hidden');
            uploadArea.classList.remove('hidden');
            progressBar.style.width = '0%';
        }
    </script>
</body>
</html>
